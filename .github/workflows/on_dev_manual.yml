name: Build and Deploy to Dev on manual dispatch

on:
  workflow_dispatch:

jobs:
  build-and-deploy-dev:
    runs-on: ubuntu-latest
    permissions:
      contents: read

    steps:
      - name: 🔧 Setup project environment
        uses: ./.github/actions/setup-project.yml

      - name: 📦 Build dev project
        run: npm run build:dev
        env:
          AIUTA_APP_BRANCH: ${{ github.ref_name }}

      - name: 🚀 Deploy to Dev
        uses: ./.github/actions/deploy-to-gcs.yml
        with:
          credentials_json: ${{ secrets.GCP_STATIC_UPLOADER_SA_KEY_JSON_DEV }}
          bucket_name: aiuta_dev_static
          destination_path: sdk/${{ github.ref_name }}/

      - name: 📋 Deployment Summary
        run: |
          echo "✅ Deployment completed successfully!"
          echo "📦 Branch: ${{ github.ref_name }}"
          echo "📁 Uploaded to: aiuta_dev_static/sdk/${{ github.ref_name }}/"
          echo ""
          echo "🔗 Files available at:"
          echo ""
          for file in dist/sdk/*; do
            filename=$(basename "$file")
            echo "- https://static.dev.aiuta.com/sdk/${{ github.ref_name }}/${filename}"
          done
